# Full updated code from canvas (pasted just now)